<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bc.pmpheep.back.commuser.teacherPlatform.dao.TeacherPlatformDao">
    <!-- 查询信息快报 -->
	<select id="queryXikb" resultType="java.util.Map" parameterType="java.util.Map">
		select
		    t.id,
			t.cover,
			b.title,
			t.activity_desc_cms_id,
			t.activity_name,
			b.id as cms_id
			from activity t
			left join cms_content b on t.info_express_cms_id=b.id
			where b.id=#{id} and t.is_deleted=0 and t.status=1
	</select>

	<!--查询相关视频-->
	<select id="Queryvideo" parameterType="java.util.Map" resultType="java.util.Map">
        select a.path,
			a.clicks,
			a.cover,
			a.title
			from activity t
			left join activity_video_chain v on v.activity_id=t.id
			left join cms_content c on c.id=t.info_express_cms_id
			left join activity_video a on a.id=v.activity_video_id
			where t.id=#{id} and a.is_deleted=0
			order by a.gmt_create desc limit ${startrow},${endrow}
	</select>

    <!--查询视频总数-->
    <select id="VideoCount" resultType="Integer">
        select count(*) from(
         select a.path,
			a.clicks,
			a.cover
			from activity t
			left join activity_video_chain v on v.activity_id=t.id
			left join cms_content c on c.id=t.info_express_cms_id
			left join activity_video a on a.id=v.activity_video_id
			where t.id=#{id} and a.is_deleted=0
        )r
    </select>

	<!--查询相关资源-->
	<select id="Querysource" resultType="java.util.Map" parameterType="java.util.Map">
	 SELECT a.source_name,
			a.file_id
			from activity t
			left join activity_source_chain b on b.activity_id=t.id
			left join activity_source a on a.id=b.activity_source_id
			where t.id=#{id} and a.is_deleted=0
			order by a.gmt_upload desc limit ${startrow},${endrow}
	</select>

    <!--查询相关资源总数-->
    <select id="sourceCount" resultType="Integer">
        select count(*) from (
             SELECT a.source_name,
                a.file_id
                from activity t
                left join activity_source_chain b on b.activity_id=t.id
                left join activity_source a on a.id=b.activity_source_id
                where t.id=#{id} and a.is_deleted=0
        )r
    </select>

	<!--增加视频播放点击数-->
	<update id="updateclicks">
		update from activity_video set clicks=${clicks} where id=#{id}
	</update>

	<!-- 查询师资培训列表 -->
	<select id="QuerySourceList" parameterType="java.util.Map" resultType="java.util.Map">
		 select b.id,t.activity_name,t.cover,t.activity_desc_cms_id,t.activity_date
              from activity t
              left join cms_content b on b.id = t.info_express_cms_id
              where t.info_express_cms_id=b.id and b.category_id=2
              order by t.gmt_create desc limit ${startrow},10
	</select>
</mapper>