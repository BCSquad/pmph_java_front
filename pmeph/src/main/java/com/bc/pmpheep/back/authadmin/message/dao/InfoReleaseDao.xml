<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bc.pmpheep.back.authadmin.message.dao.InfoReleaseDao">

	<!-- 选择消息发布对象(机构用户) 下拉菜单 -->
	<select id="selectMenu" resultType="java.util.Map">
		SELECT
		t.id,
		t.textbook_name,
		t.textbook_round
		FROM
		textbook  t
	</select>

	<!-- 查询列表 -->
	<select id="selectInfoRelease" parameterType="PageParameter"
		resultType="java.util.Map">
		SELECT
		c.user_id AS id,
		textbook_name,
		textbook_round
		FROM
		textbook a
		JOIN dec_position b ON b.textbook_id = a.id
		JOIN declaration c ON b.declaration_id = c.id
		JOIN org_user d on d.org_id = c.org_id
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="parameter。queryName != null ">
				and textbook_name like concat("%",#{parameter。queryName},"%")
			</if>
			<if test="parameter。userId != null ">
				and d.id = ${parameter。userId}
			</if>
		</trim>
		limit ${startNum},${pageSize}
	</select>

	<!-- 查询条数 -->
	<select id="selectInfoReleaseCount" parameterType="PageParameter"
		resultType="java.lang.Integer">
		select count(*) FROM
		textbook a
		JOIN dec_position b ON b.textbook_id = a.id
		JOIN declaration c ON b.declaration_id = c.id
		JOIN org_user d on d.org_id = c.org_id
		<trim prefix="WHERE" prefixOverrides="AND|OR">
			<if test="parameter。queryName != null">
				and textbook_name like concat("%",#{parameter。queryName},"%")
			</if>
			<if test="parameter。userId != null ">
				and d.id = ${parameter。userId}
			</if>
		</trim>
	</select>


</mapper>