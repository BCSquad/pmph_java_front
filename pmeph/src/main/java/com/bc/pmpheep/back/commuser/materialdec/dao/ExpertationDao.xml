<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bc.pmpheep.back.commuser.materialdec.dao.ExpertationDao" >
    <!--查询产品信息-->
    <select id="queryProductbyId" resultType="java.util.Map" parameterType="java.lang.String">
        select
          id,product_name,product_type,
          is_published*1 is_published,
          is_unit_advise_used*1 is_unit_advise_used,
          is_unit_advise_required*1 is_unit_advise_required,
          is_edu_exp_used*1 is_edu_exp_used,
          is_edu_exp_required*1 is_edu_exp_required,
          is_work_exp_used*1 is_work_exp_used,
          is_work_exp_required*1 is_work_exp_required,
          is_acade_used*1 is_acade_used,
          is_acade_required*1 is_acade_required,
          is_pmph_textbook_used*1 is_pmph_textbook_used,
          is_pmph_textbook_required*1 is_pmph_textbook_required,
          is_monograph_used*1 is_monograph_used,
          is_monograph_required*1 is_monograph_required,
          is_edit_book_used*1 is_edit_book_used,
          is_edit_book_required*1 is_edit_book_required,
          is_deleted*1 is_deleted,
          gmt_create,gmt_update,founder_id,publisher_id,gmt_publish,note,description
        from product where product_type = #{product_id}
    </select>
	<!-- 专家信息 --> 
	<select id="queryPerson" resultType="java.util.Map" parameterType="java.util.Map">
		select id,product_id,user_id,realname,sex,birthday,REPLACE(birthday,'-','.') as birthday1,experience,org_name,position,title,address,postcode,handphone,email,idtype,
		idcard,telephone,fax,online_progress,auth_date,is_staging*1 is_staging,is_deleted*1 is_deleted,
		gmt_create,gmt_update,is_dispensed*1 is_dispensed,expertise,return_cause from expertation t1
		 where 1= 1
		<if test="user_id != null and user_id != ''">
			and t1.user_id = #{user_id}
		</if>
		<if test="product_id != null and product_id != ''">
			and t1.product_id = #{product_id}
		</if>
		<if test="declaration_id != null and declaration_id != ''">
			and t1.id = #{declaration_id}
		</if>
		<if test="realname != null and realname != ''">
			and t1.realname = #{realname}
		</if>
	</select>
	<insert id="insertPerson" parameterType="java.util.Map">
		insert into expertation(product_id,expert_type,user_id,realname,sex,birthday,experience,org_name,position,
		title,address,postcode,handphone,email,idtype,idcard,telephone,fax,gmt_create,is_staging,online_progress,commit_date,sub_classification
		,cont_classification,remark,degree,unit_advise,syllabus_name
		) values(#{product_id},#{expert_type},#{user_id},#{realname},#{sex},#{birthday},#{experience},#{org_name},#{position},
		#{title},#{address},#{postcode},#{handphone},#{email},#{idtype},#{idcard},#{telephone},#{fax},#{gmt_create},
		#{is_staging},#{online_progress},#{commit_date},#{sub_classification},#{cont_classification},#{remark},#{degree},#{unit_advise},#{syllabus_name})
	</insert>
	<update id="updatePerson" parameterType="java.util.Map">
		update expertation set realname = #{realname},sex = #{sex},birthday = #{birthday},experience = #{experience},expertise = #{expertise},
		org_name = #{org_name},position = #{position},title = #{title},address = #{address},idcard=#{idcard},is_dispensed=#{is_dispensed},degree=#{degree},
		postcode = #{postcode},handphone = #{handphone},email = #{email},idtype = #{idtype},is_staging = #{is_staging},telephone = #{telephone},fax = #{fax},
		gmt_update = #{gmt_update},online_progress = #{online_progress},sub_classification = #{sub_classification},degree=#{degree}
		<if test="commit_date != null and commit_date != ''">
			,commit_date=#{commit_date}
		</if>
		,cont_classification = #{cont_classification},remark=#{remark},unit_advise=#{unit_advise},syllabus_name=#{syllabus_name}
		 where id = #{expertation_id}
	</update>

    <!-- 查询学科分类列表 -->
    <select id="querySubjectList" parameterType="PageParameter" resultType="java.util.Map">
        select * from product_subject_type t where 1=1
        <if test="parameter.type_name != null and parameter.type_name != ''">
            and t.type_name like #{parameter.type_name}
        </if>
        <if test="parameter.type_name != null and parameter.type_name != ''">
            and t.type_name like #{parameter.type_name}
        </if>
        order by parent_id asc limit #{start},#{pageSize}
    </select>
    <!-- 学科分类总数 -->
    <select id="querySubjectCount" parameterType="PageParameter" resultType="int">
        select count(*) from product_subject_type t
        <if test="parameter.type_name != null and parameter.type_name != ''">
            where t.type_name like #{parameter.type_name}
        </if>
    </select>

    <!-- 查询内容分类列表 -->
    <select id="queryContentList" parameterType="PageParameter" resultType="java.util.Map">
        select * from product_content_type_detail t where is_leaf = '1'
        <if test="parameter.name_path != null and parameter.name_path != ''">
            and t.name_path like #{parameter.name_path}
        </if>
        order by t.id asc limit #{start},#{pageSize}
    </select>
    <!-- 内容分类总数 -->
    <select id="queryContentCount" parameterType="PageParameter" resultType="int">
        select count(*) from product_content_type_detail t where is_leaf = '1'
        <if test="parameter.name_path != null and parameter.name_path != ''">
            and t.name_path like #{parameter.name_path}
        </if>
    </select>

    <!--学科分类关联表-->
    <select id="selectSubject" parameterType="java.util.Map" resultType="java.util.Map">
        select t1.*,t2.type_name from expertation_subject_type t1
	    left join product_subject_type t2 on t1.product_subject_type_id = t2.id
      where t1.expertation_id = #{expertation_id}
    </select>
    <update id="insertSubject" parameterType="java.util.Map">
        insert into expertation_subject_type(expertation_id,product_subject_type_id) VALUES(#{expertation_id},#{subjectId})
    </update>
    <delete id="delSubject" parameterType="java.lang.String">
        delete from expertation_subject_type where expertation_id = #{expertation_id}
    </delete>

    <!--内容分类关联表-->
    <select id="selectContent" parameterType="java.util.Map" resultType="java.util.Map">
       select t1.*,t2.name_path from expertation_content_type t1
	  left join product_content_type_detail t2 on t1.product_content_type_id = t2.product_type_id
        where t1.expertation_id = #{expertation_id}
    </select>
    <update id="insertContent" parameterType="java.util.Map">
        insert into expertation_content_type(expertation_id,product_content_type_id) VALUES(#{expertation_id},#{contentId})
    </update>
    <delete id="delContent" parameterType="java.lang.String">
        delete from expertation_content_type where expertation_id = #{expertation_id}
    </delete>

	<!--根据作家艾迪查询申报（首页三大新产品申报）-->
	<select id="queryExpertation" resultType="java.util.Map" parameterType="java.util.Map">
		select
			group_concat(pd.name_path  separator '_,_') as name_path,
			e.*,
			DATE_FORMAT(e.gmt_create,'%Y-%m-%d') as gmt_create_new
			from expertation e
			left join expertation_content_type et on et.expertation_id = e.id
			left join product_content_type_detail pd on et.product_content_type_id = pd.product_type_id
            where e.user_id=#{user_id}
            group by e.id
	</select>

    <!--根据用户ID查询申请表-->
	<select id="queryExpertationDetail" resultType="java.util.Map" parameterType="java.util.Map">
	   select * from expertation  where user_id=#{user_id} and expert_type=#{expert_type}
	</select>
</mapper>